# Arquitetura Makgora NVR

## 🏗️ Visão Geral

Sistema híbrido usando Python (FastAPI) para gerenciamento e Go para streaming.

## 📊 Componentes

### Backend Python (FastAPI) - Porta 8000
- **Função**: CRUD de câmeras, API REST, banco de dados
- **Memória**: ~100 MB
- **Endpoints**:
  - `GET /api/cameras` - Listar câmeras
  - `POST /api/cameras` - Criar câmera
  - `PUT /api/cameras/{id}` - Atualizar câmera
  - `DELETE /api/cameras/{id}` - Deletar câmera

### Serviço Go Streaming - Porta 8001
- **Função**: Streaming RTSP → HLS
- **Memória**: ~50-100 MB
- **Endpoints**:
  - `POST /api/stream/start/{id}` - Iniciar stream
  - `POST /api/stream/stop/{id}` - Parar stream
  - `GET /api/stream/status/{id}` - Status
  - `GET /api/stream/active` - Streams ativos

### Frontend React - Porta 5173
- **Função**: Interface web
- **Pages**: Dashboard (Painel) + Câmeras (Gerenciamento)

## 🔄 Fluxo de Dados

```
Frontend (React) → Python API (8000) - CRUD Câmeras
                → Go Streaming (8001) - Streams em tempo real
```

## 💾 Dados

```
- Backend Python: camera_db.sqlite (SQLite)
- Serviço Go: ./streams/ (arquivos HLS temporários)
```

## ⚡ Performance

| Serviço | Memória Antes | Memória Depois |
|---------|---------------|----------------|
| Python  | ~3 GB        | ~100 MB        |
| Streaming | N/A         | ~50-100 MB     |
| **Total** | **~3 GB**  | **~200 MB**    |

## 🚀 Como Executar

```bash
# Terminal 1: Backend Python
cd backend
source venv/bin/activate
python -m app.main

# Terminal 2: Serviço Go Streaming
cd streaming-service
./streaming-service

# Terminal 3: Frontend
cd frontend
nvm use 20
yarn dev
```

## 📈 Escalabilidade

- **Python**: Horizontal (múltiplas instâncias)
- **Go**: Vertical (1 instância pode lidar com 100+ streams)
- **Banco de dados**: SQLite (monolítico) → PostgreSQL (futuro)

